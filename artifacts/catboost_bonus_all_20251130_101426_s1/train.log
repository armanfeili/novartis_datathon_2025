2025-11-30 10:14:26,116 - src.train - INFO - Starting experiment: catboost_bonus_all_20251130_101426_s1
2025-11-30 10:14:26,162 - src.train - INFO - Config snapshot saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1/configs (hash: bcc22caf)
2025-11-30 10:14:26,162 - src.train - INFO - Config hash: bcc22caf
2025-11-30 10:14:26,185 - src.utils - INFO - [Load features (cached)] starting...
2025-11-30 10:14:26,186 - src.features - INFO - Building features for train S1 train...
2025-11-30 10:14:26,187 - src.data - INFO - Building train panel from raw data...
2025-11-30 10:14:26,188 - src.utils - INFO - [Load train data] starting...
2025-11-30 10:14:26,188 - src.data - INFO - Loading volume from /Users/armanfeili/code/New Projects/novartis_datathon_2025/data/raw/TRAIN/df_volume_train.csv
2025-11-30 10:14:26,274 - src.data - INFO - === train/volume Statistics ===
2025-11-30 10:14:26,275 - src.data - INFO -   Shape: 93,744 rows × 5 columns
2025-11-30 10:14:26,289 - src.data - INFO -   No missing values
2025-11-30 10:14:26,308 - src.data - INFO -   Unique series: 1,953
2025-11-30 10:14:26,309 - src.data - INFO -   months_postgx range: [-24, 23]
2025-11-30 10:14:26,311 - src.data - INFO - Loading generics from /Users/armanfeili/code/New Projects/novartis_datathon_2025/data/raw/TRAIN/df_generics_train.csv
2025-11-30 10:14:26,346 - src.data - INFO - === train/generics Statistics ===
2025-11-30 10:14:26,347 - src.data - INFO -   Shape: 46,872 rows × 4 columns
2025-11-30 10:14:26,355 - src.data - INFO -   Missing values:
2025-11-30 10:14:26,355 - src.data - INFO -     n_gxs: 26.3%
2025-11-30 10:14:26,365 - src.data - INFO -   Unique series: 1,953
2025-11-30 10:14:26,366 - src.data - INFO -   months_postgx range: [0, 23]
2025-11-30 10:14:26,367 - src.data - INFO - Loading medicine_info from /Users/armanfeili/code/New Projects/novartis_datathon_2025/data/raw/TRAIN/df_medicine_info_train.csv
2025-11-30 10:14:26,375 - src.data - INFO - === train/medicine_info Statistics ===
2025-11-30 10:14:26,375 - src.data - INFO -   Shape: 1,953 rows × 7 columns
2025-11-30 10:14:26,376 - src.data - INFO -   Missing values:
2025-11-30 10:14:26,376 - src.data - INFO -     hospital_rate: 3.3%
2025-11-30 10:14:26,378 - src.data - INFO -   Unique series: 1,953
2025-11-30 10:14:26,380 - src.utils - INFO - [Load train data] done in 0.192s
2025-11-30 10:14:26,380 - src.utils - INFO - [Build base panel] starting...
2025-11-30 10:14:26,380 - src.data - INFO - Input shapes: volume=(93744, 5), generics=(46872, 4), medicine_info=(1953, 7)
2025-11-30 10:14:26,435 - src.data - INFO - After volume-generics merge: 93,744 rows
2025-11-30 10:14:26,479 - src.data - INFO - After medicine_info merge: 93,744 rows
2025-11-30 10:14:26,555 - src.data - INFO - === Base Panel Statistics ===
2025-11-30 10:14:26,555 - src.data - INFO -   Shape: 93,744 rows × 11 columns
2025-11-30 10:14:26,584 - src.data - INFO -   Missing values:
2025-11-30 10:14:26,584 - src.data - INFO -     n_gxs: 63.2%
2025-11-30 10:14:26,584 - src.data - INFO -     hospital_rate: 3.3%
2025-11-30 10:14:26,601 - src.data - INFO -   Unique series: 1,953
2025-11-30 10:14:26,602 - src.data - INFO -   months_postgx range: [-24, 23]
2025-11-30 10:14:26,608 - src.utils - INFO - [Build base panel] done in 0.228s
2025-11-30 10:14:26,608 - src.utils - INFO - [Handle missing values] starting...
2025-11-30 10:14:26,633 - src.data - INFO - n_gxs: filled 59208 missing values
2025-11-30 10:14:26,648 - src.data - INFO - hospital_rate: filled with ther_area medians, flag added
2025-11-30 10:14:26,700 - src.data - INFO - No missing values remaining
2025-11-30 10:14:26,701 - src.utils - INFO - [Handle missing values] done in 0.092s
2025-11-30 10:14:26,702 - src.utils - INFO - [Compute pre-entry stats] starting...
2025-11-30 10:14:26,778 - src.data - INFO - avg_vol_12m distribution:
2025-11-30 10:14:26,779 - src.data - INFO -   Range: [37.72, 371038791.09]
2025-11-30 10:14:26,780 - src.data - INFO -   Median: 131382.32
2025-11-30 10:14:26,781 - src.data - INFO -   Mean: 2439028.31
2025-11-30 10:14:26,807 - src.data - INFO - Bucket classification using threshold=0.25
2025-11-30 10:14:26,873 - src.data - INFO - Bucket distribution (train):
2025-11-30 10:14:26,873 - src.data - INFO -   Bucket 1: 130 series (6.7%)
2025-11-30 10:14:26,873 - src.data - INFO -   Bucket 2: 1,823 series (93.3%)
2025-11-30 10:14:26,873 - src.data - INFO - y_norm distribution (train):
2025-11-30 10:14:26,874 - src.data - INFO -   Range: [0.000, 43.792]
2025-11-30 10:14:26,876 - src.data - INFO -   Median: 0.871
2025-11-30 10:14:26,876 - src.data - INFO -   Mean: 0.800
2025-11-30 10:14:26,878 - src.data - WARNING - y_norm.y_norm: 18 values above 5
2025-11-30 10:14:26,878 - src.utils - INFO - [Compute pre-entry stats] done in 0.176s
2025-11-30 10:14:26,900 - src.data - INFO - Panel schema validation passed for train (93,744 rows)
2025-11-30 10:14:26,903 - src.features - INFO - Applying data augmentation to training panel
2025-11-30 10:14:31,750 - src.data - INFO - Augmentation applied: jitter=5.00%, drop_prob=5.00%
2025-11-30 10:14:31,771 - src.utils - INFO - [Feature engineering - Scenario 1] starting...
2025-11-30 10:14:31,899 - src.features - WARNING - No pre-entry data for seasonal features, skipping
2025-11-30 10:14:32,559 - src.features - INFO - Total features created: 79
2025-11-30 10:14:32,559 - src.utils - INFO - [Feature engineering - Scenario 1] done in 0.788s
2025-11-30 10:14:32,647 - src.features - INFO - Selected 44,499 rows for 1 (months 0-23)
2025-11-30 10:14:32,652 - src.features - WARNING - Feature leakage detected: LEAKAGE: Forbidden column present: brand_name
2025-11-30 10:14:32,652 - src.features - WARNING - Feature leakage detected: LEAKAGE: Forbidden column present: country
2025-11-30 10:14:32,653 - src.features - WARNING - Feature leakage detected: LEAKAGE: Forbidden column present: volume
2025-11-30 10:14:32,653 - src.features - WARNING - Feature leakage detected: LEAKAGE: Forbidden column present: mean_erosion
2025-11-30 10:14:32,654 - src.features - WARNING - Feature leakage detected: LEAKAGE: Forbidden column present: y_norm
2025-11-30 10:14:32,654 - src.features - WARNING - Feature leakage detected: LEAKAGE: Forbidden column present: bucket
2025-11-30 10:14:32,701 - src.data - INFO - Data leakage audit passed for scenario 1, mode train
2025-11-30 10:14:32,711 - src.features - ERROR - Feature matrix validation failed: Feature matrix has all-NaN columns: ['first_generic_month']...
2025-11-30 10:14:32,712 - src.features - INFO - Built features: X=(44499, 76), y=44499, meta=(44499, 9)
2025-11-30 10:14:32,747 - src.utils - INFO - [Load cached train panel] starting...
2025-11-30 10:14:32,747 - src.data - INFO - Loading cached panel from /Users/armanfeili/code/New Projects/novartis_datathon_2025/data/interim/panel_train.parquet
2025-11-30 10:14:32,821 - src.data - INFO - Loaded 93,744 rows, 19 columns
2025-11-30 10:14:32,821 - src.utils - INFO - [Load cached train panel] done in 0.074s
2025-11-30 10:14:32,821 - src.utils - INFO - [Load features (cached)] done in 6.636s
2025-11-30 10:14:32,822 - src.utils - INFO - [Create validation split] starting...
2025-11-30 10:14:32,837 - src.validation - WARNING - Grouping 1 rare stratification classes (< 195 series each, 130 series total) into 'OTHER'
2025-11-30 10:14:32,840 - src.validation - INFO - 'OTHER' class now contains 130 series
2025-11-30 10:14:32,964 - src.validation - INFO - Train series: 1562, Val series: 391
2025-11-30 10:14:32,964 - src.validation - INFO - Train rows: 35,636, Val rows: 8,863
2025-11-30 10:14:32,966 - src.validation - INFO - Train bucket distribution:
bucket
2    0.933419
1    0.066581
2025-11-30 10:14:32,966 - src.validation - INFO - Val bucket distribution:
bucket
2    0.933504
1    0.066496
2025-11-30 10:14:32,994 - src.utils - INFO - [Create validation split] done in 0.172s
2025-11-30 10:14:33,034 - src.train - INFO - Features: 75 columns
2025-11-30 10:14:33,034 - src.train - INFO - Meta: 9 columns: ['country', 'brand_name', 'months_postgx', 'bucket', 'avg_vol_12m', 'y_norm', 'volume', 'mean_erosion', 'month']
2025-11-30 10:14:33,047 - src.train - INFO - Features: 75 columns
2025-11-30 10:14:33,047 - src.train - INFO - Meta: 9 columns: ['country', 'brand_name', 'months_postgx', 'bucket', 'avg_vol_12m', 'y_norm', 'volume', 'mean_erosion', 'month']
2025-11-30 10:14:33,094 - src.train - INFO - Multi-seed experiment enabled
2025-11-30 10:14:33,095 - src.train - INFO - Training with seed 42...
2025-11-30 10:14:33,100 - src.train - INFO - Applied target transform: log1p
2025-11-30 10:14:33,867 - src.train - INFO - Sample weights - min: 0.58, max: 3.46, mean: 1.00
2025-11-30 10:14:33,884 - src.utils - INFO - [Train catboost for scenario 1] starting...
2025-11-30 10:14:33,888 - src.models.cat_model - INFO - Auto-detected 2 categorical features
2025-11-30 10:14:43,949 - src.models.cat_model - INFO - CatBoost trained for 571 iterations
2025-11-30 10:14:43,949 - src.utils - INFO - [Train catboost for scenario 1] done in 10.065s
2025-11-30 10:14:45,109 - src.train - INFO - Validation metrics: Official=0.6743, RMSE=0.2004, MAE=0.1579
2025-11-30 10:14:45,109 - src.train - INFO - Training time: 10.08 seconds
2025-11-30 10:14:45,115 - src.models.cat_model - INFO - Model saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1/seed_42/model.bin.cbm with metadata
2025-11-30 10:14:45,116 - src.train - INFO - Seed 42: Official=0.6743
2025-11-30 10:14:45,116 - src.train - INFO - Training with seed 2025...
2025-11-30 10:14:45,117 - src.train - INFO - Applied target transform: log1p
2025-11-30 10:14:45,128 - src.train - INFO - Sample weights - min: 0.58, max: 3.46, mean: 1.00
2025-11-30 10:14:45,149 - src.utils - INFO - [Train catboost for scenario 1] starting...
2025-11-30 10:14:45,152 - src.models.cat_model - INFO - Auto-detected 2 categorical features
2025-11-30 10:14:50,931 - src.models.cat_model - INFO - CatBoost trained for 247 iterations
2025-11-30 10:14:50,931 - src.utils - INFO - [Train catboost for scenario 1] done in 5.782s
2025-11-30 10:14:52,003 - src.train - INFO - Validation metrics: Official=0.7182, RMSE=0.1933, MAE=0.1508
2025-11-30 10:14:52,003 - src.train - INFO - Training time: 5.80 seconds
2025-11-30 10:14:52,013 - src.models.cat_model - INFO - Model saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1/seed_2025/model.bin.cbm with metadata
2025-11-30 10:14:52,013 - src.train - INFO - Seed 2025: Official=0.7182
2025-11-30 10:14:52,014 - src.train - INFO - Training with seed 1337...
2025-11-30 10:14:52,015 - src.train - INFO - Applied target transform: log1p
2025-11-30 10:14:52,026 - src.train - INFO - Sample weights - min: 0.58, max: 3.46, mean: 1.00
2025-11-30 10:14:52,051 - src.utils - INFO - [Train catboost for scenario 1] starting...
2025-11-30 10:14:52,055 - src.models.cat_model - INFO - Auto-detected 2 categorical features
2025-11-30 10:15:02,324 - src.models.cat_model - INFO - CatBoost trained for 501 iterations
2025-11-30 10:15:02,325 - src.utils - INFO - [Train catboost for scenario 1] done in 10.274s
2025-11-30 10:15:03,414 - src.train - INFO - Validation metrics: Official=0.6814, RMSE=0.1998, MAE=0.1569
2025-11-30 10:15:03,415 - src.train - INFO - Training time: 10.30 seconds
2025-11-30 10:15:03,427 - src.models.cat_model - INFO - Model saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1/seed_1337/model.bin.cbm with metadata
2025-11-30 10:15:03,427 - src.train - INFO - Seed 1337: Official=0.6814
2025-11-30 10:15:03,433 - src.train - INFO - Saved multi-seed summary to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1/multi_seed_summary.csv
2025-11-30 10:15:03,433 - src.train - INFO - Multi-seed results:
2025-11-30 10:15:03,434 - src.train - INFO -   Mean official metric: 0.6913
2025-11-30 10:15:03,434 - src.train - INFO -   Std official metric: 0.0236
2025-11-30 10:15:03,435 - src.train - INFO -   Best seed: 42
2025-11-30 10:15:03,437 - src.train - INFO - Best seed: 42
2025-11-30 10:15:03,439 - src.train - INFO - Applied target transform: log1p
2025-11-30 10:15:03,454 - src.train - INFO - Sample weights - min: 0.58, max: 3.46, mean: 1.00
2025-11-30 10:15:03,475 - src.utils - INFO - [Train catboost for scenario 1] starting...
2025-11-30 10:15:03,481 - src.models.cat_model - INFO - Auto-detected 2 categorical features
2025-11-30 10:15:13,566 - src.models.cat_model - INFO - CatBoost trained for 571 iterations
2025-11-30 10:15:13,567 - src.utils - INFO - [Train catboost for scenario 1] done in 10.092s
2025-11-30 10:15:14,653 - src.train - INFO - Validation metrics: Official=0.6743, RMSE=0.2004, MAE=0.1579
2025-11-30 10:15:14,653 - src.train - INFO - Training time: 10.11 seconds
2025-11-30 10:15:14,656 - src.train - INFO - Fitting calibration parameters
2025-11-30 10:15:14,695 - src.train - INFO - Saved calibration parameters to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1/calibration_params.json
2025-11-30 10:15:14,698 - src.train - INFO - Calibration parameters fitted for 6 groups
2025-11-30 10:15:14,698 - src.train - INFO - Fitting bias corrections
2025-11-30 10:15:14,740 - src.train - INFO - Merged group columns from panel: ['ther_area']
2025-11-30 10:15:14,780 - src.train - INFO - Saved bias corrections to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1/bias_corrections.json
2025-11-30 10:15:14,781 - src.train - INFO - Bias corrections fitted for 241 groups
2025-11-30 10:15:14,783 - src.models.cat_model - INFO - Model saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1/model_1.bin.cbm with metadata
2025-11-30 10:15:14,783 - src.train - INFO - Model saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1/model_1.bin
2025-11-30 10:15:14,783 - src.train - INFO - Target transform parameters saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1/target_transform_params_1.json
2025-11-30 10:15:14,790 - src.train - INFO - Experiment catboost_bonus_all_20251130_101426_s1 completed. Artifacts saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1
2025-11-30 10:15:14,817 - src.utils - INFO - [Scenario 1 Training] done in 48.736s
2025-11-30 10:15:14,817 - __main__ - INFO - ================================================================================
2025-11-30 10:15:14,817 - __main__ - INFO - ✅ Scenario 1 Training Complete
2025-11-30 10:15:14,817 - __main__ - INFO -    Official Metric: 0.674300
2025-11-30 10:15:14,817 - __main__ - INFO -    RMSE (norm): 0.200359
2025-11-30 10:15:14,817 - __main__ - INFO -    MAE (norm): 0.157855
2025-11-30 10:15:14,818 - __main__ - INFO -    Artifacts: /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1
2025-11-30 10:15:14,818 - __main__ - INFO - ================================================================================
2025-11-30 10:15:14,818 - __main__ - INFO - 
================================================================================
2025-11-30 10:15:14,818 - __main__ - INFO - [2/3] Training Scenario 2
2025-11-30 10:15:14,818 - __main__ - INFO - ================================================================================
2025-11-30 10:15:14,818 - __main__ - INFO - ================================================================================
2025-11-30 10:15:14,818 - __main__ - INFO - Training Scenario 2
2025-11-30 10:15:14,818 - __main__ - INFO - ================================================================================
2025-11-30 10:15:14,818 - __main__ - INFO - Config: configs/run_bonus_all.yaml
2025-11-30 10:15:14,818 - __main__ - INFO - Run Name: catboost_bonus_all_20251130_101426
2025-11-30 10:15:14,818 - src.utils - INFO - [Scenario 2 Training] starting...
