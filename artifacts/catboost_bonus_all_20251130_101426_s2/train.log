2025-11-30 10:15:14,868 - src.train - INFO - Starting experiment: catboost_bonus_all_20251130_101426_s2
2025-11-30 10:15:14,914 - src.train - INFO - Config snapshot saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s2/configs (hash: bcc22caf)
2025-11-30 10:15:14,914 - src.train - INFO - Config hash: bcc22caf
2025-11-30 10:15:14,936 - src.utils - INFO - [Load features (cached)] starting...
2025-11-30 10:15:14,936 - src.features - INFO - Building features for train S2 train...
2025-11-30 10:15:14,938 - src.data - INFO - Building train panel from raw data...
2025-11-30 10:15:14,938 - src.utils - INFO - [Load train data] starting...
2025-11-30 10:15:14,939 - src.data - INFO - Loading volume from /Users/armanfeili/code/New Projects/novartis_datathon_2025/data/raw/TRAIN/df_volume_train.csv
2025-11-30 10:15:15,030 - src.data - INFO - === train/volume Statistics ===
2025-11-30 10:15:15,030 - src.data - INFO -   Shape: 93,744 rows × 5 columns
2025-11-30 10:15:15,047 - src.data - INFO -   No missing values
2025-11-30 10:15:15,064 - src.data - INFO -   Unique series: 1,953
2025-11-30 10:15:15,065 - src.data - INFO -   months_postgx range: [-24, 23]
2025-11-30 10:15:15,067 - src.data - INFO - Loading generics from /Users/armanfeili/code/New Projects/novartis_datathon_2025/data/raw/TRAIN/df_generics_train.csv
2025-11-30 10:15:15,098 - src.data - INFO - === train/generics Statistics ===
2025-11-30 10:15:15,099 - src.data - INFO -   Shape: 46,872 rows × 4 columns
2025-11-30 10:15:15,105 - src.data - INFO -   Missing values:
2025-11-30 10:15:15,105 - src.data - INFO -     n_gxs: 26.3%
2025-11-30 10:15:15,115 - src.data - INFO -   Unique series: 1,953
2025-11-30 10:15:15,115 - src.data - INFO -   months_postgx range: [0, 23]
2025-11-30 10:15:15,116 - src.data - INFO - Loading medicine_info from /Users/armanfeili/code/New Projects/novartis_datathon_2025/data/raw/TRAIN/df_medicine_info_train.csv
2025-11-30 10:15:15,123 - src.data - INFO - === train/medicine_info Statistics ===
2025-11-30 10:15:15,123 - src.data - INFO -   Shape: 1,953 rows × 7 columns
2025-11-30 10:15:15,124 - src.data - INFO -   Missing values:
2025-11-30 10:15:15,125 - src.data - INFO -     hospital_rate: 3.3%
2025-11-30 10:15:15,126 - src.data - INFO -   Unique series: 1,953
2025-11-30 10:15:15,127 - src.utils - INFO - [Load train data] done in 0.188s
2025-11-30 10:15:15,127 - src.utils - INFO - [Build base panel] starting...
2025-11-30 10:15:15,127 - src.data - INFO - Input shapes: volume=(93744, 5), generics=(46872, 4), medicine_info=(1953, 7)
2025-11-30 10:15:15,176 - src.data - INFO - After volume-generics merge: 93,744 rows
2025-11-30 10:15:15,213 - src.data - INFO - After medicine_info merge: 93,744 rows
2025-11-30 10:15:15,285 - src.data - INFO - === Base Panel Statistics ===
2025-11-30 10:15:15,286 - src.data - INFO -   Shape: 93,744 rows × 11 columns
2025-11-30 10:15:15,313 - src.data - INFO -   Missing values:
2025-11-30 10:15:15,313 - src.data - INFO -     n_gxs: 63.2%
2025-11-30 10:15:15,313 - src.data - INFO -     hospital_rate: 3.3%
2025-11-30 10:15:15,330 - src.data - INFO -   Unique series: 1,953
2025-11-30 10:15:15,331 - src.data - INFO -   months_postgx range: [-24, 23]
2025-11-30 10:15:15,334 - src.utils - INFO - [Build base panel] done in 0.207s
2025-11-30 10:15:15,334 - src.utils - INFO - [Handle missing values] starting...
2025-11-30 10:15:15,360 - src.data - INFO - n_gxs: filled 59208 missing values
2025-11-30 10:15:15,375 - src.data - INFO - hospital_rate: filled with ther_area medians, flag added
2025-11-30 10:15:15,432 - src.data - INFO - No missing values remaining
2025-11-30 10:15:15,432 - src.utils - INFO - [Handle missing values] done in 0.098s
2025-11-30 10:15:15,433 - src.utils - INFO - [Compute pre-entry stats] starting...
2025-11-30 10:15:15,509 - src.data - INFO - avg_vol_12m distribution:
2025-11-30 10:15:15,510 - src.data - INFO -   Range: [37.72, 371038791.09]
2025-11-30 10:15:15,511 - src.data - INFO -   Median: 131382.32
2025-11-30 10:15:15,512 - src.data - INFO -   Mean: 2439028.31
2025-11-30 10:15:15,538 - src.data - INFO - Bucket classification using threshold=0.25
2025-11-30 10:15:15,605 - src.data - INFO - Bucket distribution (train):
2025-11-30 10:15:15,605 - src.data - INFO -   Bucket 1: 130 series (6.7%)
2025-11-30 10:15:15,605 - src.data - INFO -   Bucket 2: 1,823 series (93.3%)
2025-11-30 10:15:15,605 - src.data - INFO - y_norm distribution (train):
2025-11-30 10:15:15,606 - src.data - INFO -   Range: [0.000, 43.792]
2025-11-30 10:15:15,608 - src.data - INFO -   Median: 0.871
2025-11-30 10:15:15,608 - src.data - INFO -   Mean: 0.800
2025-11-30 10:15:15,610 - src.data - WARNING - y_norm.y_norm: 18 values above 5
2025-11-30 10:15:15,610 - src.utils - INFO - [Compute pre-entry stats] done in 0.177s
2025-11-30 10:15:15,632 - src.data - INFO - Panel schema validation passed for train (93,744 rows)
2025-11-30 10:15:15,635 - src.features - INFO - Applying data augmentation to training panel
2025-11-30 10:15:20,602 - src.data - INFO - Augmentation applied: jitter=5.00%, drop_prob=5.00%
2025-11-30 10:15:20,623 - src.utils - INFO - [Feature engineering - Scenario 2] starting...
2025-11-30 10:15:20,943 - src.features - WARNING - No pre-entry data for seasonal features, skipping
2025-11-30 10:15:25,068 - src.features - INFO - Total features created: 94
2025-11-30 10:15:25,068 - src.utils - INFO - [Feature engineering - Scenario 2] done in 4.445s
2025-11-30 10:15:25,139 - src.features - INFO - Selected 33,354 rows for 2 (months 6-23)
2025-11-30 10:15:25,147 - src.features - WARNING - Feature leakage detected: LEAKAGE: Forbidden column present: brand_name
2025-11-30 10:15:25,147 - src.features - WARNING - Feature leakage detected: LEAKAGE: Forbidden column present: country
2025-11-30 10:15:25,147 - src.features - WARNING - Feature leakage detected: LEAKAGE: Forbidden column present: volume
2025-11-30 10:15:25,147 - src.features - WARNING - Feature leakage detected: LEAKAGE: Forbidden column present: mean_erosion
2025-11-30 10:15:25,147 - src.features - WARNING - Feature leakage detected: LEAKAGE: Forbidden column present: y_norm
2025-11-30 10:15:25,147 - src.features - WARNING - Feature leakage detected: LEAKAGE: Forbidden column present: bucket
2025-11-30 10:15:25,176 - src.data - INFO - Data leakage audit passed for scenario 2, mode train
2025-11-30 10:15:25,188 - src.features - INFO - Feature matrix validation passed: X=(33354, 89), y=33354, meta=(33354, 12)
2025-11-30 10:15:25,188 - src.features - INFO - Built features: X=(33354, 89), y=33354, meta=(33354, 12)
2025-11-30 10:15:25,219 - src.utils - INFO - [Load cached train panel] starting...
2025-11-30 10:15:25,220 - src.data - INFO - Loading cached panel from /Users/armanfeili/code/New Projects/novartis_datathon_2025/data/interim/panel_train.parquet
2025-11-30 10:15:25,237 - src.data - INFO - Loaded 93,744 rows, 19 columns
2025-11-30 10:15:25,237 - src.utils - INFO - [Load cached train panel] done in 0.018s
2025-11-30 10:15:25,237 - src.utils - INFO - [Load features (cached)] done in 10.302s
2025-11-30 10:15:25,237 - src.utils - INFO - [Create validation split] starting...
2025-11-30 10:15:25,250 - src.validation - WARNING - Grouping 1 rare stratification classes (< 195 series each, 130 series total) into 'OTHER'
2025-11-30 10:15:25,254 - src.validation - INFO - 'OTHER' class now contains 130 series
2025-11-30 10:15:25,371 - src.validation - INFO - Train series: 1562, Val series: 391
2025-11-30 10:15:25,371 - src.validation - INFO - Train rows: 26,726, Val rows: 6,628
2025-11-30 10:15:25,373 - src.validation - INFO - Train bucket distribution:
bucket
2    0.933419
1    0.066581
2025-11-30 10:15:25,374 - src.validation - INFO - Val bucket distribution:
bucket
2    0.933504
1    0.066496
2025-11-30 10:15:25,395 - src.utils - INFO - [Create validation split] done in 0.158s
2025-11-30 10:15:25,431 - src.train - INFO - Features: 91 columns
2025-11-30 10:15:25,431 - src.train - INFO - Meta: 9 columns: ['country', 'brand_name', 'months_postgx', 'bucket', 'avg_vol_12m', 'y_norm', 'volume', 'mean_erosion', 'month']
2025-11-30 10:15:25,439 - src.train - INFO - Features: 91 columns
2025-11-30 10:15:25,440 - src.train - INFO - Meta: 9 columns: ['country', 'brand_name', 'months_postgx', 'bucket', 'avg_vol_12m', 'y_norm', 'volume', 'mean_erosion', 'month']
2025-11-30 10:15:25,490 - src.train - INFO - Multi-seed experiment enabled
2025-11-30 10:15:25,490 - src.train - INFO - Training with seed 42...
2025-11-30 10:15:25,496 - src.train - INFO - Applied target transform: log1p
2025-11-30 10:15:25,506 - src.train - INFO - Sample weights - min: 0.63, max: 3.13, mean: 1.00
2025-11-30 10:15:25,524 - src.utils - INFO - [Train catboost for scenario 2] starting...
2025-11-30 10:15:25,531 - src.models.cat_model - INFO - Auto-detected 2 categorical features
2025-11-30 10:15:32,865 - src.models.cat_model - INFO - CatBoost trained for 336 iterations
2025-11-30 10:15:32,865 - src.utils - INFO - [Train catboost for scenario 2] done in 7.341s
2025-11-30 10:15:33,751 - src.train - INFO - Validation metrics: Official=0.2651, RMSE=0.1845, MAE=0.1456
2025-11-30 10:15:33,752 - src.train - INFO - Training time: 7.36 seconds
2025-11-30 10:15:33,763 - src.models.cat_model - INFO - Model saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s2/seed_42/model.bin.cbm with metadata
2025-11-30 10:15:33,763 - src.train - INFO - Seed 42: Official=0.2651
2025-11-30 10:15:33,763 - src.train - INFO - Training with seed 2025...
2025-11-30 10:15:33,764 - src.train - INFO - Applied target transform: log1p
2025-11-30 10:15:33,771 - src.train - INFO - Sample weights - min: 0.63, max: 3.13, mean: 1.00
2025-11-30 10:15:33,781 - src.utils - INFO - [Train catboost for scenario 2] starting...
2025-11-30 10:15:33,786 - src.models.cat_model - INFO - Auto-detected 2 categorical features
2025-11-30 10:15:39,856 - src.models.cat_model - INFO - CatBoost trained for 298 iterations
2025-11-30 10:15:39,856 - src.utils - INFO - [Train catboost for scenario 2] done in 6.075s
2025-11-30 10:15:40,766 - src.train - INFO - Validation metrics: Official=0.2682, RMSE=0.1842, MAE=0.1458
2025-11-30 10:15:40,766 - src.train - INFO - Training time: 6.08 seconds
2025-11-30 10:15:40,771 - src.models.cat_model - INFO - Model saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s2/seed_2025/model.bin.cbm with metadata
2025-11-30 10:15:40,771 - src.train - INFO - Seed 2025: Official=0.2682
2025-11-30 10:15:40,772 - src.train - INFO - Training with seed 1337...
2025-11-30 10:15:40,773 - src.train - INFO - Applied target transform: log1p
2025-11-30 10:15:40,783 - src.train - INFO - Sample weights - min: 0.63, max: 3.13, mean: 1.00
2025-11-30 10:15:40,792 - src.utils - INFO - [Train catboost for scenario 2] starting...
2025-11-30 10:15:40,797 - src.models.cat_model - INFO - Auto-detected 2 categorical features
2025-11-30 10:15:47,508 - src.models.cat_model - INFO - CatBoost trained for 352 iterations
2025-11-30 10:15:47,508 - src.utils - INFO - [Train catboost for scenario 2] done in 6.715s
2025-11-30 10:15:48,495 - src.train - INFO - Validation metrics: Official=0.2659, RMSE=0.1847, MAE=0.1465
2025-11-30 10:15:48,495 - src.train - INFO - Training time: 6.72 seconds
2025-11-30 10:15:48,506 - src.models.cat_model - INFO - Model saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s2/seed_1337/model.bin.cbm with metadata
2025-11-30 10:15:48,506 - src.train - INFO - Seed 1337: Official=0.2659
2025-11-30 10:15:48,508 - src.train - INFO - Saved multi-seed summary to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s2/multi_seed_summary.csv
2025-11-30 10:15:48,508 - src.train - INFO - Multi-seed results:
2025-11-30 10:15:48,508 - src.train - INFO -   Mean official metric: 0.2664
2025-11-30 10:15:48,509 - src.train - INFO -   Std official metric: 0.0016
2025-11-30 10:15:48,509 - src.train - INFO -   Best seed: 42
2025-11-30 10:15:48,510 - src.train - INFO - Best seed: 42
2025-11-30 10:15:48,513 - src.train - INFO - Applied target transform: log1p
2025-11-30 10:15:48,518 - src.train - INFO - Sample weights - min: 0.63, max: 3.13, mean: 1.00
2025-11-30 10:15:48,527 - src.utils - INFO - [Train catboost for scenario 2] starting...
2025-11-30 10:15:48,531 - src.models.cat_model - INFO - Auto-detected 2 categorical features
2025-11-30 10:15:56,500 - src.models.cat_model - INFO - CatBoost trained for 336 iterations
2025-11-30 10:15:56,501 - src.utils - INFO - [Train catboost for scenario 2] done in 7.974s
2025-11-30 10:15:57,341 - src.train - INFO - Validation metrics: Official=0.2651, RMSE=0.1845, MAE=0.1456
2025-11-30 10:15:57,341 - src.train - INFO - Training time: 7.98 seconds
2025-11-30 10:15:57,344 - src.train - INFO - Fitting calibration parameters
2025-11-30 10:15:57,376 - src.train - INFO - Saved calibration parameters to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s2/calibration_params.json
2025-11-30 10:15:57,377 - src.train - INFO - Calibration parameters fitted for 6 groups
2025-11-30 10:15:57,377 - src.train - INFO - Fitting bias corrections
2025-11-30 10:15:57,414 - src.train - INFO - Merged group columns from panel: ['ther_area']
2025-11-30 10:15:57,452 - src.train - INFO - Saved bias corrections to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s2/bias_corrections.json
2025-11-30 10:15:57,453 - src.train - INFO - Bias corrections fitted for 241 groups
2025-11-30 10:15:57,455 - src.models.cat_model - INFO - Model saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s2/model_2.bin.cbm with metadata
2025-11-30 10:15:57,455 - src.train - INFO - Model saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s2/model_2.bin
2025-11-30 10:15:57,456 - src.train - INFO - Target transform parameters saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s2/target_transform_params_2.json
2025-11-30 10:15:57,460 - src.train - INFO - Experiment catboost_bonus_all_20251130_101426_s2 completed. Artifacts saved to /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s2
2025-11-30 10:15:57,488 - src.utils - INFO - [Scenario 2 Training] done in 42.670s
2025-11-30 10:15:57,489 - __main__ - INFO - ================================================================================
2025-11-30 10:15:57,489 - __main__ - INFO - ✅ Scenario 2 Training Complete
2025-11-30 10:15:57,489 - __main__ - INFO -    Official Metric: 0.265100
2025-11-30 10:15:57,489 - __main__ - INFO -    RMSE (norm): 0.184547
2025-11-30 10:15:57,489 - __main__ - INFO -    MAE (norm): 0.145634
2025-11-30 10:15:57,489 - __main__ - INFO -    Artifacts: /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s2
2025-11-30 10:15:57,489 - __main__ - INFO - ================================================================================
2025-11-30 10:15:57,489 - __main__ - INFO - 
================================================================================
2025-11-30 10:15:57,489 - __main__ - INFO - [3/3] Generating Submission
2025-11-30 10:15:57,489 - __main__ - INFO - ================================================================================
2025-11-30 10:15:57,489 - __main__ - INFO - ================================================================================
2025-11-30 10:15:57,489 - __main__ - INFO - Generating Submission
2025-11-30 10:15:57,490 - __main__ - INFO - ================================================================================
2025-11-30 10:15:57,501 - src.utils - INFO - [Load cached test panel] starting...
2025-11-30 10:15:57,501 - src.data - INFO - Loading cached panel from /Users/armanfeili/code/New Projects/novartis_datathon_2025/data/interim/panel_test.parquet
2025-11-30 10:15:57,512 - src.data - INFO - Loaded 8,832 rows, 16 columns
2025-11-30 10:15:57,513 - src.utils - INFO - [Load cached test panel] done in 0.012s
2025-11-30 10:15:57,527 - __main__ - INFO - Loaded submission template from: /Users/armanfeili/code/New Projects/novartis_datathon_2025/docs/guide/submission_template.csv
2025-11-30 10:15:57,527 - src.utils - INFO - [Submission Generation] starting...
2025-11-30 10:15:57,527 - src.utils - INFO - [Generate submission] starting...
2025-11-30 10:15:57,550 - src.inference - INFO - Detected 228 Scenario 1 series
2025-11-30 10:15:57,550 - src.inference - INFO - Detected 112 Scenario 2 series
2025-11-30 10:15:57,820 - src.inference - INFO - Expanded panel: 5472 -> 10944 rows (added months 0-23)
2025-11-30 10:15:57,821 - src.utils - INFO - [Feature engineering - Scenario 1] starting...
2025-11-30 10:15:58,762 - src.features - INFO - Total features created: 88
2025-11-30 10:15:58,762 - src.utils - INFO - [Feature engineering - Scenario 1] done in 0.941s
2025-11-30 10:15:58,775 - src.inference - WARNING - Bucket 1 model not found at /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1/bucket1_catboost/model.bin
2025-11-30 10:15:58,776 - src.inference - WARNING - Bucket 2 model not found at /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1/bucket2_catboost/model.bin
2025-11-30 10:15:58,792 - src.utils - INFO - [Generate submission] done in 1.265s
2025-11-30 10:15:58,793 - src.utils - INFO - [Submission Generation] done in 1.266s
2025-11-30 10:15:58,799 - __main__ - ERROR - ================================================================================
2025-11-30 10:15:58,799 - __main__ - ERROR - ❌ Submission Generation Failed
2025-11-30 10:15:58,799 - __main__ - ERROR -    Error: features data: pandas.DataFrame column 'ther_area' has dtype 'category' but is not in  cat_features list
2025-11-30 10:15:58,799 - __main__ - ERROR - ================================================================================
2025-11-30 10:15:58,803 - __main__ - INFO - 
================================================================================
2025-11-30 10:15:58,803 - __main__ - INFO - Training and Submission Pipeline Complete!
2025-11-30 10:15:58,803 - __main__ - INFO - ================================================================================
2025-11-30 10:15:58,803 - __main__ - INFO - 
Results Summary:
2025-11-30 10:15:58,803 - __main__ - INFO -   Scenario 1:
2025-11-30 10:15:58,804 - __main__ - INFO -     Status: success
2025-11-30 10:15:58,804 - __main__ - INFO -     Official Metric: 0.6743
2025-11-30 10:15:58,804 - __main__ - INFO -     Artifacts: /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s1
2025-11-30 10:15:58,804 - __main__ - INFO -   Scenario 2:
2025-11-30 10:15:58,804 - __main__ - INFO -     Status: success
2025-11-30 10:15:58,804 - __main__ - INFO -     Official Metric: 0.2651
2025-11-30 10:15:58,804 - __main__ - INFO -     Artifacts: /Users/armanfeili/code/New Projects/novartis_datathon_2025/artifacts/catboost_bonus_all_20251130_101426_s2
2025-11-30 10:15:58,804 - __main__ - INFO -   Submission:
2025-11-30 10:15:58,804 - __main__ - INFO -     Status: failed
2025-11-30 10:15:58,804 - __main__ - INFO -     File: None
2025-11-30 10:15:58,804 - __main__ - INFO -     Rows: None
2025-11-30 10:15:58,804 - __main__ - INFO - 
Full Results: logs/results_catboost_bonus_all_20251130_101426.json
2025-11-30 10:15:58,804 - __main__ - INFO - Config Summary: logs/config_summary_catboost_bonus_all_20251130_101426.yaml
2025-11-30 10:15:58,804 - __main__ - INFO - Log File: logs/full_pipeline_catboost_bonus_all_20251130_101426.log
2025-11-30 10:15:58,804 - __main__ - INFO - ================================================================================
